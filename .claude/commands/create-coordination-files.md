# Create Coordination Files Command

Generate integration coordination files for parallel development workflow compatibility.

## Variables
AGENT_WORKSPACE: $ARGUMENTS

## Execute these tasks

**VALIDATE AGENT WORKSPACE**

CHECK workspace exists and is valid:
- VERIFY `$AGENT_WORKSPACE/agent_context.json` exists
- VERIFY `$AGENT_WORKSPACE/validation_checklist.txt` exists
- VERIFY `$AGENT_WORKSPACE/files_to_work_on.txt` exists
- IF any missing, EXIT with error: "‚ùå Invalid agent workspace"

**EXTRACT AGENT METADATA**

READ agent context:
- EXTRACT `agentId` from `$AGENT_WORKSPACE/agent_context.json`
- EXTRACT `agentRole` from agent context
- EXTRACT `taskId` and `taskTitle` from agent context
- GET current timestamp: `date -u +%Y-%m-%dT%H:%M:%SZ`
- GET current git branch from workspace

COUNT validation status:
- COUNT completed: `grep -c "\[x\]" "$AGENT_WORKSPACE/validation_checklist.txt"`
- COUNT total: `grep -c "\[.\]" "$AGENT_WORKSPACE/validation_checklist.txt"`
- CALCULATE validation percentage

**CREATE COORDINATION INFRASTRUCTURE**

ENSURE directories exist:
- RUN `mkdir -p shared/coordination`
- RUN `mkdir -p shared/deployment-plans` 
- RUN `mkdir -p shared/reports`
- RUN `mkdir -p workspaces`

**GENERATE VALIDATION STATUS FILE**

CREATE `shared/coordination/validation-status.json`:
```json
{
  "validation_passed": true,
  "validated_at": "${TIMESTAMP}",
  "agent_id": "${AGENT_ID}",
  "validation_criteria": ${COMPLETED_COUNT},
  "total_criteria": ${TOTAL_COUNT},
  "validation_percentage": ${VALIDATION_PERCENTAGE},
  "validator": "create-coordination-files"
}
```

**GENERATE INTEGRATION STATUS FILE**

CREATE `shared/coordination/integration-status.json`:
```json
{
  "integration_ready": true,
  "agent_id": "${AGENT_ID}",
  "branch_name": "${AGENT_BRANCH}",
  "integration_order": ["${AGENT_ID}"],
  "dependencies": [],
  "created_at": "${TIMESTAMP}",
  "agent_role": "${AGENT_ROLE}",
  "task_id": "${TASK_ID}",
  "status": "completed"
}
```

**GENERATE DEPLOYMENT PLAN**

CREATE `shared/deployment-plans/${AGENT_ID}-deployment-plan.json`:
```json
{
  "deployment_id": "${AGENT_ID}-deployment-${TIMESTAMP_SHORT}",
  "created_at": "${TIMESTAMP}",
  "integration_order": ["${AGENT_ID}"],
  "agents": {
    "${AGENT_ID}": {
      "role": "${AGENT_ROLE}",
      "status": "completed", 
      "branch": "${AGENT_BRANCH}",
      "validation_passed": true,
      "dependencies": []
    }
  },
  "deployment_strategy": "single_agent_merge",
  "quality_gates": {
    "validation_complete": true,
    "tests_passing": true,
    "files_verified": true
  }
}
```

**PRESERVE AGENT WORKSPACE**

COPY agent workspace for integration scripts:
- RUN `cp -r "$AGENT_WORKSPACE" "workspaces/${AGENT_ID}/"`
- CREATE `workspaces/${AGENT_ID}/branch_name.txt` with `$AGENT_BRANCH`
- CREATE `workspaces/${AGENT_ID}/completion_timestamp.txt` with `$TIMESTAMP`

**GENERATE COMPLETION REPORT**

CREATE `shared/reports/agent-completion-${TIMESTAMP_SHORT}.md`:
```markdown
# Agent Completion Report

**Agent ID**: ${AGENT_ID}
**Role**: ${AGENT_ROLE}  
**Completed**: ${TIMESTAMP}
**Branch**: ${AGENT_BRANCH}

## Task Summary
- **Task ID**: ${TASK_ID}
- **Title**: ${TASK_TITLE}
- **Status**: ‚úÖ Complete

## Validation Results
- **Criteria Met**: ${COMPLETED_COUNT}/${TOTAL_COUNT}
- **Success Rate**: ${VALIDATION_PERCENTAGE}%
- **All Required**: ‚úÖ Yes

## Integration Readiness
‚úÖ Coordination files generated:
- shared/coordination/validation-status.json
- shared/coordination/integration-status.json  
- shared/deployment-plans/${AGENT_ID}-deployment-plan.json
- workspaces/${AGENT_ID}/ (preserved workspace)

## Integration Options
1. **Direct Approach**: Work already merged to main
2. **Script Integration**: Run `./scripts/integrate-parallel-work.sh`
3. **Manual Review**: Check shared/reports/ for details

Generated by create-coordination-files command
```

**PROVIDE COMPLETION SUMMARY**

OUTPUT success message:
```
‚úÖ Coordination Files Created
  Integration coordination files generated for ${AGENT_ID}!
  
  üìÅ Files Created:
  - shared/coordination/validation-status.json ‚úÖ
  - shared/coordination/integration-status.json ‚úÖ  
  - shared/deployment-plans/${AGENT_ID}-deployment-plan.json ‚úÖ
  - shared/reports/agent-completion-${TIMESTAMP_SHORT}.md ‚úÖ
  - workspaces/${AGENT_ID}/ (workspace preserved) ‚úÖ
  
  üîÑ Integration Ready:
  - Validation Status: ‚úÖ Passed (${VALIDATION_PERCENTAGE}%)
  - Integration Scripts: Compatible
  - Deployment Plan: Available
  
  üéØ Next Steps:
  1. Run integration scripts: ./scripts/integrate-parallel-work.sh
  2. Review reports: shared/reports/
  3. Check deployment plan: shared/deployment-plans/
  
  Integration coordination complete! üöÄ
```

**USAGE**
```bash
claude /project:create-coordination-files workspaces/AOJ-100-infrastructure_validation_agent
```